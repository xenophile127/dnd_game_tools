# Tools for Dungeons & Dragons: Warriors of the Eternal Sun

These were (mostly) vibe-coded to support a Spanish translation. While the game stores almost all text in ASCII, some is stored as a (LZ-ish) compressed tilemap. These tools print usage information when run without arguments.

Use at your own risk. If you insert too large of a compressed block the game generally freezes but even this is not guaranteed. Lots of this code is generated by a LLM with correct behavior verified by visual observation in the game.

## decompress.py
Extract a compressed block. Compression is used for tilemaps and tiles. Tilemaps will be saved as a 4096 or 8192 byte binary representation. See genesis VDP documentation for the exact format but the short description is 64x32 tile with each entry being two bytes. Only 40x28 tiles are actually visible on the screen at a time.

Graphics are in the Genesis' native four bits per pixel format.

Known offsets are:
* `0x509ee`: Tiles for the large font.
* `0x50dea`: Tiles for the small font used on the title screen and intro.
* `0x5108c`: First intro text. (Large font.)
* `0x5122c`: Second intro text (Large font.)
* `0x5138c`: Third intro text (Large font.)
* `0x514e8`: Fourth intro text (Large font.)
* `0x64b14`: Title screen menu. The text "LOAD GAME" appears twice and something copies from the first occurrence for the submenu.
* `0x63ef6`: The scroll at the end of the intro with text and the game logo.
* `0x64e3a`: Title screen logo graphics.

## compress.py
Compress a raw file. Attempts to vibe-code this were unsuccessful so it's a mix of my code with generated code. It does *not* produce output identical to the original for several reasons:
* The original made weird choices such as a preference for storing copy commands that are the same size as storing the same bytes raw.
* I search for potential copies from the start of the buffer instead of the end. This isn't the standard technique for LZ, but then this isn't standard LZ--two of the three possible copy commands use offsets from the beginning. This is might be slower but compression takes a fraction of a second on my machine.
* The original had weird sub-optimal quirks, such as starting and ending each compressed block with a raw. These would usually be followed/preceded by a fill command (another detail not in standard LZ) which could have included the raw.

I'm not sure that this generates optimum compression, but in all cases I have tried it compresses better than the original.

## encode.py
Used for the large font screens in the intro. These can be hand-edited from the output of `decompress.py` but this allows writing in plain text. Text files are stored in the `en/` and `es/` directories. The focus of the text format is allowing maximum flexibility, not necessarily ease of editing. Things to know:
* Available characters are the uppercase letters A through Z, numbers zero through nine, period (full stop) comma, exclamation mark (just the one, not the Spanish upside down one, but I am now realizing tile attributes could be edited to flip it). All are two tiles wide *except* W which is three tiles wide, and the punctuation which is only one tile wide.
* Spaces are one tile wide. They are used for indentation as well as between words. The standard is two spaces between words and one after a comma but that can be changed if needed. Indentation in the original is inconsistent, but for the Spanish text if there are an odd number of tiles in a line I've chosen to add the extra offset to the beginning of the line (but I may have made mistakes).
* Since the font is two tiles high but text is centered vertically newlines are essentially two tiles if they follow text and one tile if they do not. Text has a one tile gap between lines but this can also easily be adjusted.
* In two cases in the Spanish text files there is a ' alone in an otherwise empty line between text lines. The intention is to edit the font to add an acute diacritic which can be positioned in the line above. This has not been added, these are currently ignored bye `encode.py`, and may not be positioned exactly correctly.
* The English files should be visually identical to the originals, *however* the generated tilemap will be radically different for at least two reasons: spaces are 0x0000 instead of 0x2000 to help with compression (but look identical) and there is a lot of "noise" in the originals--for instance, tile id 1 appearing randomly which is visually identical to tile id 0. This means that there is actually *a lot* of additional useable space.


## Good luck!
